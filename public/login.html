<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Login</title>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/2.1.4/toastr.min.js" integrity="sha256-yNbKY1y6h2rbVcQtf0b8lq4a+xpktyFc3pSYoGAY1qQ=" crossorigin="anonymous"></script>

    <script src="login.js"></script>
    <!--<script src="login-view.js"></script>-->

    <link rel="stylesheet" type="text/css" href="login.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/2.1.4/toastr.min.css" integrity="sha256-R91pD48xW+oHbpJYGn5xR0Q7tMhH4xOrWn1QqMRINtA=" crossorigin="anonymous" />
</head>
<body>
    <div class="form">
        <div class="form-toggle"></div>
        <div class="form-panel one">
            <div class="form-header">
                <h1>Login</h1>
            </div>
            <div class="form-content">
                <form>
                    <div class="form-group"><label for="email-login">Email</label><input type="email" id="email-login" name="email" required="required" /></div>
                    <div class="form-group"><label for="password-login">Password</label><input type="password" id="password-login" name="password" required="required" /></div>
                    <div class="form-group"><a class="form-recovery" href="#">Forgot Password?</a></div>
                    <div class="form-group login"><button type="submit" id="submit-login">Log In</button></div>
                </form>
            </div>
        </div>
        <div class="form-panel two">
            <div class="form-header">
                <h1>Register</h1>
            </div>
            <div class="form-content">
                <form>
                    <div class="form-group"><label for="name-register">Name</label><input type="text" id="name-register" name="name" required="required" /></div>
                    <div class="form-group"><label for="username-register">Username</label><input type="text" id="username-register" name="username" required="required" /></div>
                    <div class="form-group"><label for="email-register">Email</label><input type="email" id="email-register" name="email" required="required" /></div>
                    <div class="form-group"><label for="password-register">Password</label><input type="password" id="password-register" name="password" required="required" /></div>
                    <div class="form-group register"><button type="submit" id="submit-register">Register</button></div>
                </form>
            </div>
        </div>
    </div>

    <script>
        $(document).ready(function() {
            toastr.options = {
                "closeButton": false,
                "debug": false,
                "newestOnTop": false,
                "progressBar": false,
                "positionClass": "toast-bottom-center",
                "preventDuplicates": false,
                "onclick": null,
                "showDuration": "300",
                "hideDuration": "1000",
                "timeOut": "5000",
                "extendedTimeOut": "1000",
                "showEasing": "swing",
                "hideEasing": "linear",
                "showMethod": "fadeIn",
                "hideMethod": "fadeOut"
            };

            let form_panel_two = $('.form-panel.two');

            let panelOne = form_panel_two.height(),
                panelTwo = form_panel_two[0].scrollHeight;

            form_panel_two.not('.form-panel.two.active').on('click', function(e) {
                e.preventDefault();

                $('.form-toggle').addClass('visible');
                $('.form-panel.one').addClass('hidden');
                $('.form-panel.two').addClass('active');
                $('.form').animate({
                    'height': panelTwo
                }, 200);
            });

            $('.form-toggle').on('click', function(e) {
                e.preventDefault();
                $(this).removeClass('visible');
                $('.form-panel.one').removeClass('hidden');
                $('.form-panel.two').removeClass('active');
                $('.form').animate({
                    'height': panelOne
                }, 200);
            });

            $('#submit-login').on('click', function (e) {
                e.preventDefault();
                e.target.disabled = true;

                userLogin($("#email-login").val(), $("#password-login").val()).then(() => {
                    userData().then(data => {
                        localStorage.setItem("user", JSON.stringify(data));

                        toastr.success("We will be redirecting you soon", "Successfully logged in");
                    }).catch(err => toastr.error(capitalizeFirstLetter(err.toString()), "Unable to get account data"));
                }).catch(err => toastr.error(capitalizeFirstLetter(err.toString()), "Unable to login"))
                    .finally(() => e.target.disabled = false);
            });

            $('#submit-register').on('click', function (e) {
                e.preventDefault();
                e.target.disabled = true;

                userSignup($("#name-register").val(), $("#email-register").val(), $("#password-register").val(), $("#username-register").val()).then(status => {
                    if (status) {
                        $(".form-toggle").click();
                        toastr.success("You may now login", "Successfully created user");
                    } else {
                        toastr.error("An unknown error occurred", "Unable to create user");
                    }
                }).catch(err => toastr.error(capitalizeFirstLetter(err.toString()), "Unable to Sign Up"))
                    .finally(() => e.target.disabled = false);
            });
        });
    </script>
</body>
</html>